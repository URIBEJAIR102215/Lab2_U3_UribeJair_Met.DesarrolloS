<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VistaAgendarCitaJU.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">UribeJair_Lab2U3_Met</a> &gt; <a href="index.source.html" class="el_package">com.mycompany.uribejair_lab2u3_met.vista</a> &gt; <span class="el_source">VistaAgendarCitaJU.java</span></div><h1>VistaAgendarCitaJU.java</h1><pre class="source lang-java linenums">/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package com.mycompany.uribejair_lab2u3_met.vista;

import com.mycompany.uribejair_lab2u3_met.controlador.ControladorCitas;
import javax.swing.*;
import javax.swing.border.*;
import java.awt.*;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.List;

/**
 * VISTA AGENDAR CITA Interfaz rediseñada para agendar nuevas citas
 */
public class VistaAgendarCitaJU extends JFrame {

    private ControladorCitas controlador;
    private JTextField txtNombre, txtEmail, txtTelefono;
    JComboBox&lt;String&gt; comboHorarios;
    private JButton btnAgendar, btnActualizar, btnVolver;

    private List&lt;LocalDateTime&gt; horariosActuales;
<span class="fc" id="L26">    private DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy HH:mm&quot;);</span>

    // ================== PALETA OSCURA ==================
<span class="fc" id="L29">    private final Color COLOR_PRIMARIO = new Color(30, 30, 30);      // Negro suave</span>
<span class="fc" id="L30">    private final Color COLOR_SECUNDARIO = new Color(20, 33, 61);    // Azul acero</span>
<span class="fc" id="L31">    private final Color COLOR_ACENTO = new Color(0, 121, 107);       // Verde petróleo</span>
<span class="fc" id="L32">    private final Color COLOR_PELIGRO = new Color(176, 32, 32);      // Rojo oscuro</span>
<span class="fc" id="L33">    private final Color COLOR_FONDO = new Color(240, 240, 240);      // Gris claro</span>
<span class="fc" id="L34">    private final Color COLOR_PANEL = Color.WHITE;</span>

<span class="fc" id="L36">    public VistaAgendarCitaJU() {</span>
<span class="fc" id="L37">        configurarVentana();</span>
<span class="fc" id="L38">        inicializarComponentes();</span>
<span class="fc" id="L39">    }</span>

    private void configurarVentana() {
<span class="fc" id="L42">        setTitle(&quot;Sistema de Gestión de Citas | Agendar&quot;);</span>
<span class="fc" id="L43">        setSize(780, 760);</span>
<span class="fc" id="L44">        setDefaultCloseOperation(DISPOSE_ON_CLOSE);</span>
<span class="fc" id="L45">        setLocationRelativeTo(null);</span>
<span class="fc" id="L46">        setLayout(new BorderLayout(15, 15));</span>
<span class="fc" id="L47">        getContentPane().setBackground(COLOR_FONDO);</span>
<span class="fc" id="L48">    }</span>

    private void inicializarComponentes() {
<span class="fc" id="L51">        add(crearPanelTitulo(), BorderLayout.NORTH);</span>
<span class="fc" id="L52">        add(crearPanelFormulario(), BorderLayout.CENTER);</span>
<span class="fc" id="L53">        add(crearPanelBotones(), BorderLayout.SOUTH);</span>
<span class="fc" id="L54">    }</span>

    // ================== TITULO ==================
    private JPanel crearPanelTitulo() {
<span class="fc" id="L58">        JPanel panel = new JPanel();</span>
<span class="fc" id="L59">        panel.setBackground(COLOR_SECUNDARIO);</span>
<span class="fc" id="L60">        panel.setBorder(new EmptyBorder(25, 25, 25, 25));</span>
<span class="fc" id="L61">        panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));</span>

<span class="fc" id="L63">        JLabel lblTitulo = new JLabel(&quot;AGENDAR NUEVA CITA&quot;);</span>
<span class="fc" id="L64">        lblTitulo.setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 30));</span>
<span class="fc" id="L65">        lblTitulo.setForeground(Color.WHITE);</span>
<span class="fc" id="L66">        lblTitulo.setAlignmentX(Component.CENTER_ALIGNMENT);</span>

<span class="fc" id="L68">        JLabel lblSub = new JLabel(&quot;Ingrese los datos requeridos para el registro&quot;);</span>
<span class="fc" id="L69">        lblSub.setFont(new Font(&quot;Segoe UI&quot;, Font.PLAIN, 14));</span>
<span class="fc" id="L70">        lblSub.setForeground(new Color(200, 200, 200));</span>
<span class="fc" id="L71">        lblSub.setAlignmentX(Component.CENTER_ALIGNMENT);</span>

<span class="fc" id="L73">        panel.add(lblTitulo);</span>
<span class="fc" id="L74">        panel.add(Box.createVerticalStrut(6));</span>
<span class="fc" id="L75">        panel.add(lblSub);</span>

<span class="fc" id="L77">        return panel;</span>
    }

    // ================== FORMULARIO ==================
    private JPanel crearPanelFormulario() {
<span class="fc" id="L82">        JPanel panel = new JPanel(new GridBagLayout());</span>
<span class="fc" id="L83">        panel.setBackground(COLOR_PANEL);</span>
<span class="fc" id="L84">        panel.setBorder(BorderFactory.createCompoundBorder(</span>
                new LineBorder(COLOR_PRIMARIO, 2, true),
                new EmptyBorder(30, 30, 30, 30)
        ));

<span class="fc" id="L89">        GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="fc" id="L90">        gbc.insets = new Insets(14, 14, 14, 14);</span>
<span class="fc" id="L91">        gbc.fill = GridBagConstraints.HORIZONTAL;</span>

        // Nombre
<span class="fc" id="L94">        gbc.gridx = 0;</span>
<span class="fc" id="L95">        gbc.gridy = 0;</span>
<span class="fc" id="L96">        panel.add(crearLabel(&quot;Nombre Completo&quot;), gbc);</span>

<span class="fc" id="L98">        gbc.gridx = 1;</span>
<span class="fc" id="L99">        txtNombre = crearTextField();</span>
<span class="fc" id="L100">        panel.add(txtNombre, gbc);</span>

        // Email
<span class="fc" id="L103">        gbc.gridx = 0;</span>
<span class="fc" id="L104">        gbc.gridy = 1;</span>
<span class="fc" id="L105">        panel.add(crearLabel(&quot;Correo Electrónico&quot;), gbc);</span>

<span class="fc" id="L107">        gbc.gridx = 1;</span>
<span class="fc" id="L108">        txtEmail = crearTextField();</span>
<span class="fc" id="L109">        panel.add(txtEmail, gbc);</span>

        // Teléfono
<span class="fc" id="L112">        gbc.gridx = 0;</span>
<span class="fc" id="L113">        gbc.gridy = 2;</span>
<span class="fc" id="L114">        panel.add(crearLabel(&quot;Número de Teléfono&quot;), gbc);</span>

<span class="fc" id="L116">        gbc.gridx = 1;</span>
<span class="fc" id="L117">        txtTelefono = crearTextField();</span>
<span class="fc" id="L118">        panel.add(txtTelefono, gbc);</span>

        // Horario
<span class="fc" id="L121">        gbc.gridx = 0;</span>
<span class="fc" id="L122">        gbc.gridy = 3;</span>
<span class="fc" id="L123">        panel.add(crearLabel(&quot;Horario Disponible&quot;), gbc);</span>

<span class="fc" id="L125">        gbc.gridx = 1;</span>
<span class="fc" id="L126">        comboHorarios = new JComboBox&lt;&gt;();</span>
<span class="fc" id="L127">        comboHorarios.setFont(new Font(&quot;Segoe UI&quot;, Font.PLAIN, 14));</span>
<span class="fc" id="L128">        comboHorarios.setPreferredSize(new Dimension(380, 42));</span>
<span class="fc" id="L129">        comboHorarios.setBackground(Color.WHITE);</span>
<span class="fc" id="L130">        comboHorarios.setBorder(new LineBorder(COLOR_PRIMARIO, 1, true));</span>
<span class="fc" id="L131">        panel.add(comboHorarios, gbc);</span>

        // Info
<span class="fc" id="L134">        gbc.gridx = 0;</span>
<span class="fc" id="L135">        gbc.gridy = 4;</span>
<span class="fc" id="L136">        gbc.gridwidth = 2;</span>
<span class="fc" id="L137">        gbc.insets = new Insets(25, 14, 10, 14);</span>
<span class="fc" id="L138">        panel.add(crearPanelInfo(), gbc);</span>

<span class="fc" id="L140">        return panel;</span>
    }

    // ================== PANEL INFO (ESTILO REGLAS) ==================
    private JPanel crearPanelInfo() {
<span class="fc" id="L145">        JPanel panel = new JPanel();</span>
<span class="fc" id="L146">        panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));</span>
<span class="fc" id="L147">        panel.setBackground(new Color(38, 50, 56));</span>
<span class="fc" id="L148">        panel.setBorder(BorderFactory.createCompoundBorder(</span>
                new LineBorder(Color.BLACK, 2, true),
                new EmptyBorder(18, 18, 18, 18)
        ));

<span class="fc" id="L153">        JLabel titulo = new JLabel(&quot;REGLAS DEL SISTEMA&quot;);</span>
<span class="fc" id="L154">        titulo.setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 14));</span>
<span class="fc" id="L155">        titulo.setForeground(Color.WHITE);</span>
<span class="fc" id="L156">        titulo.setAlignmentX(Component.LEFT_ALIGNMENT);</span>

<span class="fc" id="L158">        panel.add(titulo);</span>
<span class="fc" id="L159">        panel.add(Box.createVerticalStrut(10));</span>

<span class="fc" id="L161">        String[] reglas = {</span>
            &quot;La cita debe registrarse con 24 horas de anticipación&quot;,
            &quot;Duración estándar: 30 minutos&quot;,
            &quot;La cancelación se realiza desde el menú principal&quot;,
            &quot;Se enviará confirmación al correo registrado&quot;
        };

<span class="fc bfc" id="L168" title="All 2 branches covered.">        for (String r : reglas) {</span>
<span class="fc" id="L169">            JLabel lbl = new JLabel(&quot;• &quot; + r);</span>
<span class="fc" id="L170">            lbl.setFont(new Font(&quot;Segoe UI&quot;, Font.PLAIN, 13));</span>
<span class="fc" id="L171">            lbl.setForeground(new Color(207, 216, 220));</span>
<span class="fc" id="L172">            lbl.setAlignmentX(Component.LEFT_ALIGNMENT);</span>
<span class="fc" id="L173">            panel.add(lbl);</span>
<span class="fc" id="L174">            panel.add(Box.createVerticalStrut(4));</span>
        }

<span class="fc" id="L177">        return panel;</span>
    }

    // ================== BOTONES ==================
    private JPanel crearPanelBotones() {
<span class="fc" id="L182">        JPanel panel = new JPanel(new FlowLayout(FlowLayout.CENTER, 15, 20));</span>
<span class="fc" id="L183">        panel.setBackground(COLOR_FONDO);</span>

<span class="fc" id="L185">        btnVolver = crearBoton(&quot;Volver&quot;, new Color(69, 90, 100));</span>
<span class="fc" id="L186">        btnActualizar = crearBoton(&quot;Actualizar Horarios&quot;, COLOR_SECUNDARIO);</span>
<span class="fc" id="L187">        btnAgendar = crearBoton(&quot;Confirmar Cita&quot;, COLOR_ACENTO);</span>

<span class="pc" id="L189">        btnVolver.addActionListener(e -&gt; dispose());</span>
<span class="pc" id="L190">        btnActualizar.addActionListener(e -&gt; controlador.actualizarHorariosDisponibles());</span>
<span class="pc" id="L191">        btnAgendar.addActionListener(e -&gt; agendarCita());</span>

<span class="fc" id="L193">        panel.add(btnVolver);</span>
<span class="fc" id="L194">        panel.add(btnActualizar);</span>
<span class="fc" id="L195">        panel.add(btnAgendar);</span>

<span class="fc" id="L197">        return panel;</span>
    }

    private JButton crearBoton(String texto, Color color) {
<span class="fc" id="L201">        JButton btn = new JButton(texto);</span>
<span class="fc" id="L202">        btn.setBackground(color);</span>
<span class="fc" id="L203">        btn.setForeground(Color.WHITE);</span>
<span class="fc" id="L204">        btn.setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 14));</span>
<span class="fc" id="L205">        btn.setPreferredSize(new Dimension(210, 48));</span>
<span class="fc" id="L206">        btn.setBorderPainted(false);</span>
<span class="fc" id="L207">        btn.setFocusPainted(false);</span>
<span class="fc" id="L208">        btn.setCursor(new Cursor(Cursor.HAND_CURSOR));</span>

<span class="fc" id="L210">        btn.addMouseListener(new java.awt.event.MouseAdapter() {</span>
            public void mouseEntered(java.awt.event.MouseEvent e) {
<span class="nc" id="L212">                btn.setBackground(color.darker());</span>
<span class="nc" id="L213">            }</span>

            public void mouseExited(java.awt.event.MouseEvent e) {
<span class="nc" id="L216">                btn.setBackground(color);</span>
<span class="nc" id="L217">            }</span>
        });

<span class="fc" id="L220">        return btn;</span>
    }

    private JLabel crearLabel(String texto) {
<span class="fc" id="L224">        JLabel lbl = new JLabel(texto);</span>
<span class="fc" id="L225">        lbl.setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 14));</span>
<span class="fc" id="L226">        lbl.setForeground(COLOR_PRIMARIO);</span>
<span class="fc" id="L227">        return lbl;</span>
    }

    private JTextField crearTextField() {
<span class="fc" id="L231">        JTextField txt = new JTextField();</span>
<span class="fc" id="L232">        txt.setFont(new Font(&quot;Segoe UI&quot;, Font.PLAIN, 14));</span>
<span class="fc" id="L233">        txt.setPreferredSize(new Dimension(380, 42));</span>
<span class="fc" id="L234">        txt.setBorder(BorderFactory.createCompoundBorder(</span>
                new LineBorder(COLOR_PRIMARIO, 1, true),
                new EmptyBorder(8, 12, 8, 12)
        ));
<span class="fc" id="L238">        return txt;</span>
    }

    // ================== LOGICA (SIN CAMBIOS) ==================
    private void agendarCita() {
<span class="nc bnc" id="L243" title="All 6 branches missed.">        if (comboHorarios.getSelectedIndex() == -1 || horariosActuales == null || horariosActuales.isEmpty()) {</span>
<span class="nc" id="L244">            mostrarError(&quot;Seleccione un horario válido&quot;);</span>
<span class="nc" id="L245">            return;</span>
        }

<span class="nc" id="L248">        String nombre = txtNombre.getText().trim();</span>
<span class="nc" id="L249">        String email = txtEmail.getText().trim();</span>
<span class="nc" id="L250">        String telefono = txtTelefono.getText().trim();</span>

<span class="nc bnc" id="L252" title="All 6 branches missed.">        if (nombre.isEmpty() || email.isEmpty() || telefono.isEmpty()) {</span>
<span class="nc" id="L253">            mostrarError(&quot;Complete todos los campos&quot;);</span>
<span class="nc" id="L254">            return;</span>
        }

<span class="nc" id="L257">        LocalDateTime fecha = horariosActuales.get(comboHorarios.getSelectedIndex());</span>
<span class="nc" id="L258">        controlador.agendarCita(nombre, email, telefono, fecha);</span>
<span class="nc" id="L259">    }</span>

    public void setControlador(ControladorCitas c) {
<span class="fc" id="L262">        this.controlador = c;</span>
<span class="fc" id="L263">    }</span>

    public void actualizarComboHorarios(List&lt;LocalDateTime&gt; horarios) {
<span class="fc" id="L266">        horariosActuales = horarios;</span>
<span class="fc" id="L267">        comboHorarios.removeAllItems();</span>

<span class="fc bfc" id="L269" title="All 2 branches covered.">        if (horarios.isEmpty()) {</span>
<span class="fc" id="L270">            comboHorarios.addItem(&quot;Sin horarios disponibles&quot;);</span>
<span class="fc" id="L271">            comboHorarios.setEnabled(false);</span>
<span class="fc" id="L272">            btnAgendar.setEnabled(false);</span>
<span class="fc" id="L273">            return;</span>
        }

<span class="fc" id="L276">        comboHorarios.setEnabled(true);</span>
<span class="fc" id="L277">        btnAgendar.setEnabled(true);</span>

<span class="fc bfc" id="L279" title="All 2 branches covered.">        for (LocalDateTime h : horarios) {</span>
<span class="fc" id="L280">            comboHorarios.addItem(h.format(formatter));</span>
<span class="fc" id="L281">        }</span>
<span class="fc" id="L282">    }</span>

    public void mostrarError(String msg) {
<span class="nc" id="L285">        JOptionPane.showMessageDialog(this, msg, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L286">    }</span>

    public void limpiarFormulario() {
<span class="fc" id="L289">        txtNombre.setText(&quot;&quot;);</span>
<span class="fc" id="L290">        txtEmail.setText(&quot;&quot;);</span>
<span class="fc" id="L291">        txtTelefono.setText(&quot;&quot;);</span>
<span class="pc bpc" id="L292" title="1 of 2 branches missed.">        if (comboHorarios.getItemCount() &gt; 0) {</span>
<span class="nc" id="L293">            comboHorarios.setSelectedIndex(0);</span>
        }
<span class="fc" id="L295">        txtNombre.requestFocus();</span>
<span class="fc" id="L296">        System.out.println(&quot;Formulario limpiado&quot;);</span>
<span class="fc" id="L297">    }</span>

    public void mostrarMensaje(String mensaje) {
<span class="nc" id="L300">        JOptionPane.showMessageDialog(this, mensaje, &quot;Informacion&quot;,</span>
                JOptionPane.INFORMATION_MESSAGE);
<span class="nc" id="L302">    }</span>

    public void mostrarExito(String mensaje) {
<span class="nc" id="L305">        JOptionPane.showMessageDialog(this, mensaje,</span>
                &quot;Operacion Exitosa&quot;, JOptionPane.INFORMATION_MESSAGE);
<span class="nc" id="L307">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>